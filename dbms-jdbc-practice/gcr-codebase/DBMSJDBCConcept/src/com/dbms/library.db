
+----+-------------------+-----------+--------------+--------------+
| id | title             | author_id | category     | is_available |
+----+-------------------+-----------+--------------+--------------+
|  1 | Harry Potter      |         1 | Fantasy      |            1 |
|  2 | A Game of Thrones |         2 | Epic Fantasy |            1 |
|  3 | The Shining       |         3 | Horror       |            1 |
+----+-------------------+-----------+--------------+--------------+

+----+-------------+-----+
| id | name        | age |
+----+-------------+-----+
|  1 | John Doe    |  20 |
|  2 | Jane Smith  |  22 |
|  3 | Alex Rivera |  19 |
+----+-------------+-----+

+----+--------------------+-----+
| id | name               | age |
+----+--------------------+-----+
|  1 | J.K. Rowling       |  58 |
|  2 | George R.R. Martin |  75 |
|  3 | Stephen King       |  76 |
+----+--------------------+-----+

+----+---------+------------+-------------+------------+-------------+
| id | book_id | student_id | borrow_date | due_date   | return_date |
+----+---------+------------+-------------+------------+-------------+
|  1 |       1 |          1 | 2026-02-09  | 2026-02-23 | 2026-02-28  |
+----+---------+------------+-------------+------------+-------------+


CREATE DATABASE library_db;

USE library_db;

-- table creation logic
CREATE TABLE author (id INTEGER PRIMARY KEY AUTO_INCREMENT, name VARCHAR (255) NOT NULL, age INTEGER NOT NULL);

CREATE TABLE student (id INTEGER PRIMARY KEY AUTO_INCREMENT, name VARCHAR (255) NOT NULL, age INTEGER NOT NULL);

CREATE TABLE books (
    id INTEGER PRIMARY key AUTO_INCREMENT,
    title VARCHAR (255) NOT NULL,
    author_id INTEGER,
    category VARCHAR (255),
    is_available BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (author_id) REFERENCES author(id)
);

CREATE TABLE borrowing_records (
    id INTEGER PRIMARY KEY AUTO_INCREMENT,
    book_id INTEGER,0
    student_id INTEGER,
    borrow_date DATE,
    due_date DATE,
    return_date DATE DEFAULT NULL,
    FOREIGN KEY (book_id) REFERENCES books(id),
    FOREIGN KEY (student_id) REFERENCES student(id)
);

-- Adding Authors
INSERT INTO
    author (name, age)
VALUES
    ('J.K. Rowling', 58),
    ('George R.R. Martin', 75),
    ('Stephen King', 76);

-- Adding Students
INSERT INTO
    student (name, age)
VALUES
    ('John Doe', 20),
    ('Jane Smith', 22),
    ('Alex Rivera', 19);

INSERT INTO
    books (title, author_id, category)
VALUES
    ('Harry Potter', 1, 'Fantasy'),
    ('A Game of Thrones', 2, 'Epic Fantasy'),
    ('The Shining', 3, 'Horror');

-- Borrowing Book
START TRANSACTION;

INSERT INTO
    borrowing_records (book_id, student_id, borrow_date, due_date)
VALUES
    (1, 1, '2026-02-09', '2026-02-23');

UPDATE
    books
SET
    is_available = FALSE
WHERE
    id = 1;

COMMIT;

-- Checking the fine
SELECT
    id,
    DATEDIFF('2026-02-28', due_date) AS days_late,
    (DATEDIFF('2026-02-28', due_date) * 5) AS fine_amount
FROM
    borrowing_records
WHERE
    '2026-02-28' > due_date
    AND book_id = 1
    AND student_id = 1
    AND return_date IS NULL;

-- Returning the book
START TRANSACTION;

UPDATE
    borrowing_records
SET
    return_date = '2026-02-28'
WHERE
    book_id = 1
    AND student_id = 1
    AND return_date IS NULL;

UPDATE
    books
SET
    is_available = TRUE
WHERE
    id = 1;

COMMIT;

-- search
SELECT
    b.title,
    a.name AS author,
    b.category
FROM
    books b
    JOIN author a ON b.author_id = a.id
WHERE
    b.category = 'Fantasy'
    AND b.is_available = TRUE;